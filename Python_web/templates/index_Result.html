<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Removal Reflection</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/css/index.css">
    <link rel="shortcut icon" type="image/png" href="../static/img/logoSIRR.png"/>
</head>
<body>
    <div class="container-fluid container" id="container">
        <div class="row row-no-gutters ">
            <div class="col-lg-12 col-md-12 col-sm-12" id="content">
                <div class="container">
                    <div class="row">
                    
                        <div class="col-lg-12 col-md-12 col-sm-12 px-0" id="title">
                            <h1>REFFLECTION REMOVAL</h1>
                        </div>
                        <div class="col-sm-6 col-lg-6 col-md-6" id="image_input_left">
                            <div id="image_input">
                                <!--Options-->
                                <div id="option_intput">
                                    <div class='upload_part'>
                                        
                                        <button class='upload_button btn btn-primary' id="upload_button" >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-arrow-up" viewBox="0 0 16 16">
                                                <path d="M8 11a.5.5 0 0 0 .5-.5V6.707l1.146 1.147a.5.5 0 0 0 .708-.708l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 .5.5z"/>
                                                <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
                                              </svg>
                                        
                                            Choose image
                                        </button>
                                        <form class="button" action="/" method="POST" enctype="multipart/form-data" id='form'>
                                            <input  type="file" name="image" id="image-input" accept="image/*" style="display:none">
                                            
                                            <button id="use_img" class="btn btn-primary" method="POST" type="submit" value="Remove refflection">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-magic" viewBox="0 0 16 16">
                                                    <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0v1.829Zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707L14 2.707ZM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707L7.293 4Zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1h1.829Zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1h1.829ZM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707L13.293 10ZM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0v1.829Zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0L8.354 9.06Z"/>
                                                  </svg>
                                                Remove refflection
                                            </button>
                                        </form>
                                        <button class='upload_button btn btn-primary' type="button" id="zoom-in"> 
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-zoom-in" viewBox="0 0 16 16">
                                                <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                                <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                                <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                                              </svg>
                                            
                                        </button>
                                        <button class='upload_button btn btn-primary' type="button" id="zoom-out">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-zoom-out" viewBox="0 0 16 16">
                                                <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                                <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                                <path fill-rule="evenodd" d="M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                                              </svg>
                                            
                                        </button>
                                    </div>
                                    <div id="Show_image_input">
                                        <!--Show Image-->
                                        <div id="loader"></div>
                                        <div class='result_part'>
                                            <img style="max-width:28em"
                                                    src="data:image/jpg;base64,{{ img_ORG }}" 
                                                    id="display_image"  >
                                        </div>
                                    </div>                               
                                </div>
                                
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-6 col-md-6" id="image_output_left">
                            <div id="image_output">
                                <div id="option_output">
                                    <div>
                                        <form id="form" class="button">
                                            
                                            <button  class="btn btn-primary" type="button" value="Download image" id="download_image">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-arrow-down" viewBox="0 0 16 16">
                                                    <path d="M8 5a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5A.5.5 0 0 1 8 5z"/>
                                                    <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
                                                  </svg>
                                                Download image
                                            </button>
                                        </form>
                                    </div>
                                    <button class='upload_button btn btn-primary' type="button" id="zoom-in_out"> 
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-zoom-in" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                            <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                            <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                                          </svg>
                                        
                                    </button>
                                    <button class='upload_button btn btn-primary' type="button" id="zoom-out_out">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-zoom-out" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                            <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                            <path fill-rule="evenodd" d="M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                                          </svg>
                                        
                                    </button>
                                    <div id="show_output_img">
                                        <img src=" data:image/jpg;base64,{{ img_SIRR }}"  
                                        style="max-width:28em"
                                        id="display_image_out" 
                                        alt="Image description">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        

        <footer>
            <div id="footer" class="container container-fluid ">
                <div class="row">
                    <div class="col-md-4 col-sm-4 col-lg-4" id="">
                        <img src="../static/img/logo_iuh.png" id="logo_iuh" alt="">
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4" id="contact">
                        <h4>CONTACT</h4>
    
                        <ul>
                            <li>Industrial University of Ho Chi Minh City</li>
                            <li>Address: No.12 Nguyen Van Bao Street, Ward 4, Go Vap District, Ho Chi Minh City.</li>
                            <li>Phone: 0283.8940 390</li>
                            <li>Email: dhcn@iuh.edu.vn</li>
                        </ul>  
                    </div>
                    <div class="col-md-4 col-sm-4 col-lg-4" id="">
                        <h4>RELEASE BY</h4>
    
                        <ul>
                            <li>Phan Nhat Hao <br> Email: 19520881.hao@student.iuh.edu.vn</li>
                            
                            <li>Nong Dinh Nam <br> Email: 19520931.nam@student.iuh.edu.vn </li>
                            
                        </ul> 
                    </div>
                    
                </div>
                <div class="row" id = "license">
                    <p id="license_content" >Copyright &copy; 2023 - Developed from a thesis on the <a style="color: rgb(0, 25, 189);" href="https://ieeexplore.ieee.org/document/6909748">Single Image Layer Separation using Relative Smoothness method</a>, which was published in 2014.</p>
                    <p>The website is solely intended for educational and research purposes.</p>
                </div>
            </div>
            
        </footer>
        
        <script>
            //sự kiện cho div ảnh đầu vào
    $("#upload_button").click(function() {
        $("#image-input").trigger('click');
    });
    $("#image-input").change(function () {
        let reader = new FileReader();
        reader.onload = function () {
            let dataURL = reader.result;
    
            imEl = document.getElementById("display_image");
            imEl.onload = function () {
            predict();
            }
            $("#display_image").attr("src", dataURL);
            $("#result_info").empty();
        }
        let file = $("#image-input").prop("files")[0];
        reader.readAsDataURL(file);
    });
    /*sử dụng ảnh*/
    function loader_processing(){
                var loader = document.getElementById('loader');
                loader.style.display = 'block';
                setTimeout(function() {
                    loader.style.display = 'none';
                }, 2000000);
            }
    $("#use_img").click(function(event) {
        var imageInput = document.getElementById("image-input");
        if(imageInput.value === ""){
            event.preventDefault();
            window.alert("Please select a photo before use!");
        }else{
            loader_processing();
            document.getElementById('use_img').submit();

        }
    });
    /*download ảnh*/
    $("#download_image").click(function() {
        downloadImage('data:image/jpg;base64,{{ img_SIRR }}');
    });
    function downloadImage(url) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'blob';
        xhr.onload = function() {
            if (xhr.status === 200) {
                var urlCreator = window.URL || window.webkitURL;
                var imageUrl = urlCreator.createObjectURL(xhr.response);
                var tag = document.createElement('a');
                tag.href = imageUrl;
                tag.download = 'image.png';
                document.body.appendChild(tag);
                tag.click();
                document.body.removeChild(tag);
            }
        };
        xhr.send();
    }
    
    //phóng to thu nhỏ ảnh input
    const image = document.getElementById("display_image");
    const zoomInButton = document.getElementById("zoom-in");
    const zoomOutButton = document.getElementById("zoom-out");
    
    let scale = 1;
    
    zoomInButton.addEventListener("click", () => {
    scale += 0.1;
    image.style.transform = `scale(${scale})`;
    });
    
    zoomOutButton.addEventListener("click", () => {
    if (scale > 0.2) {
        scale -= 0.1;
        image.style.transform = `scale(${scale})`;
    }
    });
    //phóng to thu nhỏ ảnh output
    const image1 = document.getElementById("display_image_out");
    const zoomInButton1 = document.getElementById("zoom-in_out");
    const zoomOutButton1 = document.getElementById("zoom-out_out");
    
    let scale1 = 1;
    
    zoomInButton1.addEventListener("click", () => {
    scale1 += 0.1;
    image1.style.transform = `scale(${scale1})`;
    });
    
    zoomOutButton1.addEventListener("click", () => {
    if (scale1 > 0.2) {
        scale1 -= 0.1;
        image1.style.transform = `scale(${scale1})`;
    }
    });

        </script>
    </div>
</body>
</html>